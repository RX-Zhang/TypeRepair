--- 
+++ 
@@ -19,5 +19,13 @@
     }
     double ld = InfoSetUtil.doubleValue(left);
     double rd = InfoSetUtil.doubleValue(right);
-    return evaluateCompare(ld == rd ? 0 : ld < rd ? -1 : 1);
+    if (Double.isNaN(ld) || Double.isNaN(rd)) {
+        // NaN comparisons: only equality with NaN to NaN is true for '=' (equal), others false
+        return evaluateCompare(ld == rd ? 0 : 1); 
+        // when ld or rd is NaN but ld != rd, treat as not equal: so -1 or 1 - but just above returns 1
+        // This depends on evaluateCompare behavior
+    } else {
+        return evaluateCompare(ld == rd ? 0 : ld < rd ? -1 : 1);
+    }
 }
+
