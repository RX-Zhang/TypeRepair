--- 
+++ 
@@ -19,5 +19,20 @@
     }
     double ld = InfoSetUtil.doubleValue(left);
     double rd = InfoSetUtil.doubleValue(right);
+
+    // Fix for NaN handling: comparisons involving NaN should return false except NaN = NaN returns true
+    boolean ldNaN = Double.isNaN(ld);
+    boolean rdNaN = Double.isNaN(rd);
+    if (ldNaN || rdNaN) {
+        // For equals: NaN == NaN should return true, else false
+        if (ldNaN && rdNaN) {
+            return evaluateCompare(0);
+        } else {
+            // If one is NaN and the other not, always return false
+            return false;
+        }
+    }
+
     return evaluateCompare(ld == rd ? 0 : ld < rd ? -1 : 1);
 }
+
