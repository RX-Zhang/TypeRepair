--- 
+++ 
@@ -9,11 +9,18 @@
         return formatLongOctalBytes(value, buf, offset, length);
     }
 
+    // Add boundary check for length
+    if (length < 1 || length > buf.length - offset) {
+        throw new IllegalArgumentException("Invalid length: " + length);
+    }
+
     if (length < 9) {
         formatLongBinary(value, buf, offset, length, negative);
+    } else {
+        formatBigIntegerBinary(value, buf, offset, length, negative);
     }
-    formatBigIntegerBinary(value, buf, offset, length, negative);
 
     buf[offset] = (byte) (negative ? 0xff : 0x80);
     return offset + length;
 }
+
