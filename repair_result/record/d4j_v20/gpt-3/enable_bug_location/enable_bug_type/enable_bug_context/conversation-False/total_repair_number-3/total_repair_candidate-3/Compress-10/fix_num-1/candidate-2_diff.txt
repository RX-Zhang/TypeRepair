--- 
+++ 
@@ -7,13 +7,24 @@
     // directory order
     for (ZipArchiveEntry ze : entries.keySet()) {
         OffsetEntry offsetEntry = entries.get(ze);
+        if (offsetEntry == null) {
+            throw new RuntimeException("OffsetEntry for " + ze.getName() + " not found");
+        }
+        
         long offset = offsetEntry.headerOffset;
         archive.seek(offset + LFH_OFFSET_FOR_FILENAME_LENGTH);
+        
         byte[] b = new byte[SHORT];
         archive.readFully(b);
         int fileNameLen = ZipShort.getValue(b);
+        
         archive.readFully(b);
         int extraFieldLen = ZipShort.getValue(b);
+        
+        if (fileNameLen < 0 || extraFieldLen < 0) {
+            throw new IllegalArgumentException("Invalid length for fileName or extraField");
+        }
+        
         int lenToSkip = fileNameLen;
         while (lenToSkip > 0) {
             int skipped = archive.skipBytes(lenToSkip);
@@ -23,6 +34,7 @@
             }
             lenToSkip -= skipped;
         }
+        
         byte[] localExtraData = new byte[extraFieldLen];
         archive.readFully(localExtraData);
         ze.setExtra(localExtraData);
@@ -41,3 +53,4 @@
         }
     }
 }
+
