--- 
+++ 
@@ -25,7 +25,7 @@
         Elements metaElements = doc.select("meta[http-equiv=content-type], meta[charset]");
         String foundCharset = null; // if not found, will keep utf-8 as best attempt
         for (Element meta : metaElements) {
-            if (meta.hasAttr("http-equiv"))
+            if (meta.hasAttr("http-equiv") && meta.attr("http-equiv").equalsIgnoreCase("content-type"))
                 foundCharset = getCharsetFromContentType(meta.attr("content"));
             if (foundCharset == null && meta.hasAttr("charset"))
                 foundCharset = meta.attr("charset");
@@ -73,9 +73,38 @@
             throw e.ioException();
         }
         Charset charset = Charset.forName(charsetName);
+        // check if charset can encode, else fallback
+        if (!charset.newEncoder().canEncode()) {
+            charset = Charset.forName("UTF-8");
+            charsetName = "UTF-8";
+        }
         doc.outputSettings().charset(charset);
-            // some charsets can read but not encode; switch to an encodable charset and update the meta el
+
+        if (!charsetName.equalsIgnoreCase(defaultCharset)) {
+            // update the meta charset element to reflect charset, usually UTF-8 fallback
+            Elements metaCharset = doc.select("meta[charset]");
+            if (!metaCharset.isEmpty()) {
+                for (Element meta : metaCharset) {
+                    meta.attr("charset", charsetName);
+                }
+            } else {
+                Elements metaContentTypes = doc.select("meta[http-equiv=content-type]");
+                if (!metaContentTypes.isEmpty()) {
+                    for (Element meta : metaContentTypes) {
+                        meta.attr("content", "text/html; charset=" + charsetName);
+                    }
+                } else {
+                    // add a charset meta element to head
+                    Element head = doc.head();
+                    if (head == null) {
+                        head = doc.prependElement("head");
+                    }
+                    head.appendElement("meta").attr("charset", charsetName);
+                }
+            }
+        }
     }
     input.close();
     return doc;
 }
+
