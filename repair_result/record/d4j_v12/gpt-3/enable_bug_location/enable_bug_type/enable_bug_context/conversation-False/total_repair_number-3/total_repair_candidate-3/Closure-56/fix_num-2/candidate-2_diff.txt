--- 
+++ 
@@ -31,12 +31,18 @@
   lastOffset = pos;
   lastLine = lineNumber;
 
-  if (js.indexOf('\n', pos) == -1) {
+  int nextNewlinePos = js.indexOf('\n', pos);
+  if (nextNewlinePos == -1) {
     // If next new line cannot be found, there are two cases
     // 1. pos already reaches the end of file, then null should be returned
     // 2. otherwise, return the contents between pos and the end of file.
+    if (pos >= js.length()) {
       return null;
+    } else {
+      return js.substring(pos);
+    }
   } else {
-    return js.substring(pos, js.indexOf('\n', pos));
+    return js.substring(pos, nextNewlinePos);
   }
 }
+
