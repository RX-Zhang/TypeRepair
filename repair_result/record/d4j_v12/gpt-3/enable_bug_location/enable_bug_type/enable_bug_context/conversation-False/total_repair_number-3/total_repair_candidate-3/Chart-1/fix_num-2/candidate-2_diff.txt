--- 
+++ 
@@ -5,10 +5,10 @@
     }
     int index = this.plot.getIndexOf(this);
     CategoryDataset dataset = this.plot.getDataset(index);
-    if (dataset != null) {
+    if (dataset == null) { // Fix logical error: return if dataset is null
         return result;
     }
-    int seriesCount = dataset.getRowCount();
+    int seriesCount = dataset.getRowCount(); // Corrected this line, was out of scope of dataset
     if (plot.getRowRenderingOrder().equals(SortOrder.ASCENDING)) {
         for (int i = 0; i < seriesCount; i++) {
             if (isSeriesVisibleInLegend(i)) {
@@ -18,8 +18,7 @@
                 }
             }
         }
-    }
-    else {
+    } else {
         for (int i = seriesCount - 1; i >= 0; i--) {
             if (isSeriesVisibleInLegend(i)) {
                 LegendItem item = getLegendItem(index, i);
@@ -31,3 +30,4 @@
     }
     return result;
 }
+
