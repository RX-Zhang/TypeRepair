--- 
+++ 
@@ -17,16 +17,21 @@
             }
 
             double sumWts = 0;
-            for (int i = 0; i < weights.length; i++) {
+            for (int i = begin; i < begin + length; i++) { // Fix: Loop should consider the segment defined by begin and length
                 sumWts += weights[i];
             }
 
-            if (isBiasCorrected) {
-                var = (accum - (accum2 * accum2 / sumWts)) / (sumWts - 1.0);
+            if (sumWts > 0) { // Fix: Ensure sumWts is greater than zero to avoid division by zero
+                if (isBiasCorrected) {
+                    var = (accum - (accum2 * accum2 / sumWts)) / (sumWts - 1.0);
+                } else {
+                    var = (accum - (accum2 * accum2 / sumWts)) / sumWts;
+                }
             } else {
-                var = (accum - (accum2 * accum2 / sumWts)) / sumWts;
+                var = Double.NaN; // Fix: Handle case where sumWts is zero
             }
         }
     }
     return var;
 }
+
