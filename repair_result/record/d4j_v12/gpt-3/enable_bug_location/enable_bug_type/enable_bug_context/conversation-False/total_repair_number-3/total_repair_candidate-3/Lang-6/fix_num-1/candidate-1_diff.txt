--- 
+++ 
@@ -12,13 +12,18 @@
         if (consumed == 0) {
             char[] c = Character.toChars(Character.codePointAt(input, pos));
             out.write(c);
-            pos+= c.length;
+            pos += c.length;
             continue;
         }
         // contract with translators is that they have to understand codepoints 
         // and they just took care of a surrogate pair
         for (int pt = 0; pt < consumed; pt++) {
+            if (pos >= len) {
+                // Prevent StringIndexOutOfBoundsException
+                break;
+            }
             pos += Character.charCount(Character.codePointAt(input, pos));
         }
     }
 }
+
