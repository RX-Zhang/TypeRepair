--- 
+++ 
@@ -26,8 +26,17 @@
             return 0;
         }
 
+        if(entityValue > 0xFFFF) {
+            // Encode as surrogate pair
+            char highSurrogate = (char) (((entityValue - 0x10000) >> 10) + 0xD800);
+            char lowSurrogate = (char) (((entityValue - 0x10000) & 0x3FF) + 0xDC00);
+            out.write(highSurrogate);
+            out.write(lowSurrogate);
+        } else {
             out.write(entityValue);
+        }
         return 2 + (end - start) + (isHex ? 1 : 0) + 1;
     }
     return 0;
 }
+
