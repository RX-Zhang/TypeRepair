--- 
+++ 
@@ -32,9 +32,13 @@
     // the checks for broken requires turned off. In these cases, we
     // allow broken requires to be preserved by the first run to
     // let them be caught in the subsequent run.
-    if (provided != null) {
-      parent.detachFromParent();
-      compiler.reportCodeChange();
+    if (provided == null || !provided.isExplicitlyProvided()) {
+      // do not remove the require node if the provide is missing or not explicit
+      return;
     }
+
+    parent.detachFromParent();
+    compiler.reportCodeChange();
   }
 }
+
