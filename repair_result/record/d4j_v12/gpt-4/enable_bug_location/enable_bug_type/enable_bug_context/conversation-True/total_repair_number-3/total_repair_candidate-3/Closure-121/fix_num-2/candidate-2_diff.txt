--- 
+++ 
@@ -48,10 +48,8 @@
   if (!maybeModifiedArguments &&
       !staleVars.contains(v) &&
       referenceInfo.isWellDefined() &&
-      referenceInfo.isAssignedOnceInLifetime()) {
-      // Inlining the variable based solely on well-defined and assigned
-      // once is *NOT* correct. We relax the correctness requirement if
-      // the variable is declared constant.
+      referenceInfo.isAssignedOnceInLifetime() &&
+      getFilterForMode().apply(v)) {  // Added filtering based on mode
     List<Reference> refs = referenceInfo.references;
     for (int i = 1 /* start from a read */; i < refs.size(); i++) {
       Node nameNode = refs.get(i).getNode();
@@ -72,3 +70,4 @@
     }
   }
 }
+
