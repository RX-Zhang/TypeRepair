--- 
+++ 
@@ -6,6 +6,10 @@
     // are lots of warnings in one file.
     js = getCode();
   } catch (IOException e) {
+    return null;
+  }
+
+  if (lineNumber < 1) {
     return null;
   }
 
@@ -22,21 +26,24 @@
   for (int n = startLine; n < lineNumber; n++) {
     int nextpos = js.indexOf('\n', pos);
     if (nextpos == -1) {
+      // We have fewer lines than requested
       return null;
     }
     pos = nextpos + 1;
   }
 
-  // Remember this offset for the next search we do.
   lastOffset = pos;
   lastLine = lineNumber;
 
-  if (js.indexOf('\n', pos) == -1) {
-    // If next new line cannot be found, there are two cases
-    // 1. pos already reaches the end of file, then null should be returned
-    // 2. otherwise, return the contents between pos and the end of file.
+  int endPos = js.indexOf('\n', pos);
+  if (endPos == -1) {
+    // Return remainder of code if not at EOF
+    if (pos >= js.length()) {
       return null;
+    }
+    return js.substring(pos);
   } else {
-    return js.substring(pos, js.indexOf('\n', pos));
+    return js.substring(pos, endPos);
   }
 }
+
