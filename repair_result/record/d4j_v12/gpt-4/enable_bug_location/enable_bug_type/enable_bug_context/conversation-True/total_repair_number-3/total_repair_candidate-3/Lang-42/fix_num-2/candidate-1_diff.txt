--- 
+++ 
@@ -1,20 +1,24 @@
 public void escape(Writer writer, String str) throws IOException {
     int len = str.length();
     for (int i = 0; i < len; i++) {
-        char c = str.charAt(i);
-        String entityName = this.entityName(c);
+        int codepoint = str.codePointAt(i);
+        String entityName = this.entityName(codepoint);
         if (entityName == null) {
-            if (c > 0x7F) {
+            if (codepoint > 0x7F) {
                 writer.write("&#");
-                writer.write(Integer.toString(c, 10));
+                writer.write(Integer.toString(codepoint, 10));
                 writer.write(';');
             } else {
-                writer.write(c);
+                writer.write(codepoint);
             }
         } else {
             writer.write('&');
             writer.write(entityName);
             writer.write(';');
         }
+        if (Character.isSupplementaryCodePoint(codepoint)) {
+            i++; // skip the next char as it is part of the supplementary code point
+        }
     }
 }
+
