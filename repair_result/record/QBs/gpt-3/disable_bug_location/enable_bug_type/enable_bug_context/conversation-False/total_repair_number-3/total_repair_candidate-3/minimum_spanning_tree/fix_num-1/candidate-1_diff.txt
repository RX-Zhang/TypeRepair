--- 
+++ 
@@ -5,8 +5,11 @@
         u, v = edge
         if group_by_node.setdefault(u, {u}) != group_by_node.setdefault(v, {v}):
             mst_edges.add(edge)
-            group_by_node[u].update(group_by_node[v])
-            for node in group_by_node[v]:
-                group_by_node[node].update(group_by_node[u])
+            # Merge the sets safely by using a copy of group_by_node[v]
+            v_group = group_by_node[v]
+            u_group = group_by_node[u]
+            u_group.update(v_group)
+            for node in list(v_group):
+                group_by_node[node] = u_group
     return mst_edges
 
